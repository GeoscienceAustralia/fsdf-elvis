"use strict";!function(e){function t(e,t,n){var r=this;n.getMap().then(function(e){r.map=e}),t.getConfig().then(function(e){r.data=e;try{var t=document.createElement("canvas");e.modern=!(!window.WebGLRenderingContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(n){e.modern=!1}})}e.module("WaterApp",["common.altthemes","common.bbox","common.cc4","common.clip","common.download","common.extent","common.header","common.navigation","common.templates","common.toolbar","common.wms","explorer.config","explorer.confirm","explorer.drag","explorer.enter","explorer.flasher","explorer.googleanalytics","explorer.httpdata","explorer.info","explorer.legend","explorer.message","explorer.modal","explorer.persist","explorer.projects","explorer.tabs","explorer.version","exp.ui.templates","explorer.map.templates","ui.bootstrap","ui.bootstrap-slider","ngAutocomplete","ngRoute","ngSanitize","page.footer","geo.baselayer.control","geo.draw","geo.geosearch","geo.map","geo.maphelper","geo.measure","water.panes","water.templates","water.select"]).config(["configServiceProvider","persistServiceProvider","projectsServiceProvider","versionServiceProvider",function(e,t,n,r){e.location("icsm/resources/config/water.json"),e.dynamicLocation("icsm/resources/config/appConfig.json?t="),r.url("icsm/assets/package.json"),t.handler("local"),n.setProject("icsm")}]).config(["$routeProvider",function(e){e.when("/administrativeBoundaries",{templateUrl:"admin/app/app.html",controller:"adminCtrl",controllerAs:"admin"}).when("/positioning",{templateUrl:"positioning/app/app.html",controller:"positioningCtrl",controllerAs:"positioning"}).when("/placeNames",{templateUrl:"placenames/app/app.html",controller:"placeNamesCtrl",controllerAs:"placeNames"}).when("/landParcelAndProperty",{templateUrl:"landParcelAndProperty/app/app.html",controller:"landParcelAndPropertyCtrl",controllerAs:"landParcelAndProperty"}).when("/imagery",{templateUrl:"imagery/app/app.html",controller:"imageryCtrl",controllerAs:"imagery"}).when("/transport",{templateUrl:"transport/app/app.html",controller:"transportCtrl",controllerAs:"transport"}).when("/water",{templateUrl:"water/app/app.html",controller:"waterCtrl",controllerAs:"water"}).when("/elevationAndDepth",{templateUrl:"elevationAndDepth/app/app.html",controller:"elevationAndDepthCtrl",controllerAs:"elevationAndDepth"}).when("/landCover",{templateUrl:"landCover/app/app.html",controller:"landCoverCtrl",controllerAs:"landCover"}).when("/icsm",{templateUrl:"icsm/app/app.html",controller:"icsmCtrl",controllerAs:"icsm"}).otherwise({redirectTo:"/icsm"})}]).factory("userService",[function(){function e(){return!0}return{login:e,hasAcceptedTerms:e,setAcceptedTerms:e,getUsername:function(){return"anon"}}}]).controller("RootCtrl",t),t.$invoke=["$http","configService","mapService"]}(angular),function(e){function t(e){e.data().then(function(e){this.data=e}.bind(this))}function n(){return{add:function(e){},remove:function(e){}}}e.module("water.panes",[]).directive("icsmPanes",["$rootScope","$timeout","mapService",function(e,t,n){return{templateUrl:"water/panes/panes.html",transclude:!0,scope:{defaultItem:"@",data:"="},controller:["$scope",function(r){var o=!1;r.view=r.defaultItem,r.setView=function(t){var a=r.view;r.view==t?(t&&(o=!0),r.view=""):(t||(o=!0),r.view=t),e.$broadcast("view.changed",r.view,a),o&&n.getMap().then(function(e){e._onResize()})},t(function(){e.$broadcast("view.changed",r.view,null)},50)}]}}]).directive("icsmTabs",[function(){return{templateUrl:"water/panes/tabs.html",require:"^icsmPanes"}}]).controller("PaneCtrl",t).factory("paneService",n),t.$inject=["paneService"],n.$inject=[]}(angular),function(e){function t(e,t,r,o,a,i){function s(){o(function(){g._executeQuery()},100)}var l,c="Search Layers",d="icsm/resources/config/water_select.json",p={text:"",daterange:{enabled:!1,upper:null,lower:null},bbox:{fromMap:!0,intersects:!0,yMax:null,yMin:null,xMax:null,xMin:null},defaultKeywords:[],keywords:[]},u={},h="#ff7800",m="darkblue",g={getSelectCriteria:function(){return p},getLayerGroup:function(){return l||(l=a.getGroup(c)),l},setKeywords:function(e){},setFilter:function(e){},refresh:function(){},getDaterange:function(){return p.daterange},more:function(){},_executeQuery:function(){e.get(d,{cache:!0}).then(function(e){g.getLayerGroup();var t=e.data;t.response.docs.forEach(function(e){g._decorateDataset(e),"group"==e.type&&e.docs.forEach(function(e){g._decorateDataset(e)})}),r.$broadcast("select.facet.counts",t),r.$broadcast("select.results.received",t)})},createLayer:function(e,t){var n,r,o,a=e.bbox,i=e.primaryId;if(o=u[i],!o){if(!a)return null;if(n=a.split(" "),4!=n.length)return null;t||(t=h),r=[[+n[1],+n[0]],[+n[3],+n[2]]],o=L.rectangle(r,{fill:!1,color:"#000000",width:3,clickable:!1}),u[i]=o}return this._decorateDataset(e),l.addLayer(o),o},_decorateDataset:function(e){function t(e){var t;return e?(t=e.split(/\s/g),{xMin:+t[0],xMax:+t[2],yMax:+t[3],yMin:+t[1]}):null}var r=u[e.primaryId];r?(e.layer=r,e.showLayer=!0):(e.layer=null,e.showLayer=!1,e.services=n(e.dcUris),e.bounds=t(e.bbox))},showWithin:function(e){function t(e,t,n,r){var o=p.bbox;return e>o.xMin&&n<o.xMax&&t>o.yMin&&r<o.yMax}e.forEach(function(e){var n,r=e.bbox;r?(n=r.split(" "),4==n.length&&t(+n[0],+n[1],+n[2],+n[3])?g.createLayer(e):g.removeLayer(e)):g.removeLayer(e)})},toggle:function(e){e.showLayer?this.removeLayer(e):this.createLayer(e)},toggleAll:function(e){var t=this,n=e.some(function(e){return!e.showLayer});return e.forEach(function(e){n?e.showLayer||t.createLayer(e):e.showLayer&&t.removeLayer(e)}),!n},hideAll:function(e){e.forEach(function(e){e.showLayer&&g.removeLayer(e)})},hilight:function(e){e.setStyle({color:m})},lolight:function(e){e.setStyle({color:h})},removeLayer:function(e){var t=e.primaryId,n=u[t];n&&(l.removeLayer(n),delete u[t]),this._decorateDataset(e)}};return s(),g}function n(e){function t(e){this.uris=e,this.container={wcs:null,wms:null},e?this.services=e.map(function(e){var t=new n(e);return this.container.wcs=t.isWcs()?t:this.container.wcs,this.container.wms=t.isWms()?t:this.container.wms,t}.bind(this)):this.services=[],this.hasWcs=function(){return null!==this.container.wcs},this.hasWms=function(){return null!==this.container.wms},this.getWcs=function(){return this.container.wcs},this.getWms=function(){return this.container.wms},this.remove=function(){this.services.forEach(function(e){e.remove()})}}function n(e){var t=$(e);this.protocol=t.attr("protocol"),this.url=t.text(),this.layerNames=t.attr("layerNames"),this.name=t.attr("name"),this.description=t.attr("description"),this.handlers=[],this.isWcs=function(){return this.protocol==r.WCS},this.isWfs=function(){return this.protocol==r.WFS},this.isWms=function(){return this.protocol==r.WMS},this.isSupported=function(){return"undefined"==typeof r[this.protocol]},this.addHandler=function(e){this.handlers.push(e)},this.removeHandler=function(e){this.handlers.push(e)},this.remove=function(){this.handlers.forEach(function(e){this.callback.remove&&e.remove(this)}.bind(this)),this.handlers=[]}}var r={WCS:"OGC:WCS",WFS:"OGC:WFS",WMS:"OGC:WMS"};return new t(e)}e.module("water.select.service",[]).factory("selectService",t),t.$inject=["$http","$q","$rootScope","$timeout","mapService","configService"]}(angular),function(e){function t(e){this.criteria=e.getSelectCriteria(),this.refresh=function(){e.refresh()}}function n(e,t,n,r){var o,a=this;e.$on("select.results.received",function(e,t){n.remove(o),a.data=t}),t.getConfig("facets").then(function(e){this.hasKeywords=e&&e.keywordMapped&&e.keywordMapped.length>0}.bind(this)),this.select=function(){n.remove(o),o=n.add("Selecting",3e3,!0),r.setFilter(this.filter)},this.toggle=function(e){r.toggle(e)},this.toggleAll=function(){r.toggleAll(this.data.response.docs)},this.showWithin=function(){r.showWithin(this.data.response.docs)},this.allShowing=function(){return this.data&&this.data.response?!this.data.response.docs.some(function(e){return!e.showLayer}):!1},this.anyShowing=function(){return this.data&&this.data.response?this.data.response.docs.some(function(e){return e.showLayer}):!1},this.hideAll=function(){r.hideAll(this.data.response.docs)},this.hilight=function(e){e.layer&&r.hilight(e.layer)},this.lolight=function(e){e.layer&&r.lolight(e.layer)}}e.module("water.select",["water.select.service"]).controller("SelectCtrl",n).controller("SelectCriteriaCtrl",t).directive("waterSelect",[function(){return{templateUrl:"water/select/select.html",link:function(e,t,n){console.log("Hello select!")}}}]).directive("selectDoc",[function(){return{templateUrl:"water/select/doc.html",link:function(e,t,n){console.log("What's up doc!")}}}]).directive("selectGroup",[function(){return{templateUrl:"water/select/group.html",scope:{group:"="},link:function(e,t,n){console.log("What's up doc!")}}}]).filter("pubDate",function(){return function(e){var t;return e?(t=new Date(e),t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear()):"-"}}).filter("authors",function(){return function(e){return e?e.join(", "):"-"}}).filter("truncate",function(){return function(e,t){return e&&e.length>t-3?e.substr(0,t-3)+"...":e}}),t.$inject=["selectService"],n.$inject=["$rootScope","configService","flashService","selectService"]}(angular),angular.module("water.templates",[]).run(["$templateCache",function(e){e.put("water/panes/panes.html",'<div class="container contentContainer">\r\n	<div class="row icsmPanesRow" >\r\n		<div class="icsmPanesCol" ng-class="{\'col-md-12\':!view, \'col-md-7\':view}" style="padding-right:0">\r\n			<div class="expToolbar row noPrint" icsm-toolbar-row map="root.map"></div>\r\n			<div class="panesMapContainer" geo-map configuration="data.map">\r\n			    <geo-extent></geo-extent>\r\n			</div>\r\n    		<div geo-draw data="data.map.drawOptions" line-event="elevation.plot.data" rectangle-event="bounds.drawn"></div>\r\n    		<div icsm-tabs class="icsmTabs"  ng-class="{\'icsmTabsClosed\':!view, \'icsmTabsOpen\':view}"></div>\r\n		</div>\r\n		<div class="icsmPanesColRight" ng-class="{\'hidden\':!view, \'col-md-5\':view}" style="padding-left:0; padding-right:0">\r\n			<div class="panesTabContentItem" ng-show="view == \'datasets\'" water-select></div>\r\n			<div class="panesTabContentItem" ng-show="view == \'glossary\'" water-glossary></div>\r\n			<div class="panesTabContentItem" ng-show="view == \'help\'" water-help></div>\r\n		</div>\r\n	</div>\r\n</div>'),e.put("water/panes/tabs.html",'<!-- tabs go here -->\r\n<div id="panesTabsContainer" class="paneRotateTabs" style="opacity:0.9" ng-style="{\'right\' : contentLeft +\'px\'}">\r\n\r\n	<div class="paneTabItem" ng-class="{\'bold\': view == \'datasets\'}" ng-click="setView(\'datasets\')">\r\n		<button class="undecorated">Datasets</button>\r\n	</div>\r\n	<div class="paneTabItem" ng-class="{\'bold\': view == \'glossary\'}" ng-click="setView(\'glossary\')">\r\n		<button class="undecorated">Glossary</button>\r\n	</div>\r\n	<div class="paneTabItem" ng-class="{\'bold\': view == \'help\'}" ng-click="setView(\'help\')">\r\n		<button class="undecorated">Help</button>\r\n	</div>\r\n</div>\r\n'),e.put("water/select/doc.html",'<div ng-class-odd="\'odd\'" ng-class-even="\'even\'" ng-mouseleave="select.lolight(doc)" ng-mouseenter="select.hilight(doc)">\r\n	<span ng-class="{ellipsis:!expanded}" tooltip-enable="!expanded" style="width:100%;display:inline-block;"\r\n			tooltip-class="selectAbstractTooltip" tooltip="{{doc.abstract | truncate : 250}}" tooltip-placement="bottom">\r\n		<button type="button" class="undecorated" ng-click="expanded = !expanded" title="Click to see more about this dataset">\r\n			<i class="fa pad-right fa-lg" ng-class="{\'fa-caret-down\':expanded,\'fa-caret-right\':(!expanded)}"></i>\r\n		</button>\r\n		<download-add item="doc" group="group"></download-add>\r\n		<common-wms data="doc"></common-wms>\r\n		<common-bbox data="doc" ng-if="doc.showExtent"></common-bbox>\r\n		<common-cc4></common-cc4>\r\n		<a href="http://www.ga.gov.au/metadata-gateway/metadata/record/{{doc.sysId}}" target="_blank" ><strong>{{doc.title}}</strong></a>\r\n	</span>\r\n	<span ng-class="{ellipsis:!expanded}" style="width:100%;display:inline-block;padding-right:15px;">\r\n		{{doc.abstract}}\r\n	</span>\r\n	<div ng-show="expanded" style="padding-bottom: 5px;">\r\n		<h5>Keywords</h5>\r\n		<div>\r\n			<span class="badge" ng-repeat="keyword in doc.keywords track by $index">{{keyword}}</span>\r\n		</div>\r\n	</div>\r\n</div>'),e.put("water/select/group.html",'<div class="panel panel-default" style="margin-bottom:-5px;" >\r\n	<div class="panel-heading"><nedf-wms data="group"></nedf-wms> <strong>{{group.title}}</strong></div>\r\n	<div class="panel-body">\r\n   		<div ng-repeat="doc in group.docs">\r\n   			<select-doc doc="doc" group="group"></select-doc>\r\n		</div>\r\n	</div>\r\n</div>\r\n'),e.put("water/select/select.html",'<div>\r\n	<div style="position:relative;padding:5px;padding-left:10px;" ng-controller="SelectCtrl as select" class="scrollPanel">\r\n		<div class="panel panel-default" style="margin-bottom:-5px">\r\n  			<div class="panel-heading">\r\n  				<h3 class="panel-title">Available datasets</h3>\r\n  			</div>\r\n  			<div class="panel-body">\r\n				<div ng-repeat="doc in select.data.response.docs" style="padding-bottom:7px">\r\n					<select-doc ng-if="doc.type == \'dataset\'" doc="doc"></select-doc>\r\n					<select-group ng-if="doc.type == \'group\'" group="doc"></select-group>\r\n				</div>\r\n  			</div>\r\n		</div>\r\n	</div>\r\n</div>')}]);